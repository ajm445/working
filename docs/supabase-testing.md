# Supabase 거래 내역 연동 테스트 가이드

## 📌 문서 정보

- **작성일**: 2025-10-20
- **목적**: Supabase 데이터베이스 연동 후 기능 테스트 및 검증
- **대상**: 거래 내역 CRUD 및 실시간 동기화 기능

---

## ✅ 완료된 작업

### 1. 데이터베이스 설정
- ✅ **transactions 테이블 생성** - PostgreSQL 스키마 구축
- ✅ **RLS (Row Level Security) 정책 설정** - 사용자별 데이터 보안
- ✅ **인덱스 생성** - 쿼리 성능 최적화

### 2. 프론트엔드 구현
- ✅ **TypeScript 타입 정의** - database.ts 업데이트
- ✅ **CRUD 서비스 레이어** - transactionService.ts 구현
- ✅ **실시간 구독** - Supabase Realtime 연동
- ✅ **MainApp 마이그레이션** - 로컬 state → Supabase

---

## 🧪 테스트 시나리오

### Phase 1: 기본 CRUD 테스트

#### 1.1 거래 내역 추가
```bash
1. 브라우저에서 http://localhost:3000 접속
2. 로그인 (이미 로그인된 상태라면 건너뛰기)
3. "내역 추가하기" 버튼 클릭
4. 다음 정보 입력:
   - 유형: 지출 선택
   - 금액: 50000
   - 카테고리: 식비
   - 설명: 점심 식사
   - 통화: KRW
   - 날짜: 오늘 날짜 (기본값)
5. "추가" 버튼 클릭
```

**예상 결과**:
- ✅ 거래 내역이 목록에 즉시 표시됨
- ✅ 대시보드의 지출 금액이 업데이트됨
- ✅ 잔액이 재계산됨
- ✅ 브라우저 콘솔에 에러 없음

**Supabase Dashboard 확인**:
1. Supabase Dashboard > Table Editor > transactions
2. 방금 추가한 거래 확인:
   - `user_id`: 현재 사용자 ID
   - `type`: 'expense'
   - `amount`: 50000
   - `category`: '식비'
   - `description`: '점심 식사'
   - `currency`: 'KRW'
   - `amount_in_krw`: 50000

---

#### 1.2 거래 내역 조회
```bash
1. 페이지 새로고침 (F5)
2. 로딩 스피너 확인
3. 거래 내역 자동 로드 확인
```

**예상 결과**:
- ✅ 로딩 중 메시지 표시: "거래 내역을 불러오는 중..."
- ✅ 이전에 추가한 거래 내역이 표시됨
- ✅ 최신 거래가 맨 위에 표시됨 (날짜 역순 정렬)

---

#### 1.3 거래 내역 삭제
```bash
1. 거래 내역 목록에서 삭제할 항목 찾기
2. 삭제 버튼 클릭
3. 삭제 확인
```

**예상 결과**:
- ✅ 거래 내역이 목록에서 즉시 사라짐
- ✅ 대시보드 금액이 재계산됨
- ✅ Supabase 데이터베이스에서도 삭제됨

**Supabase Dashboard 확인**:
- transactions 테이블에서 해당 거래가 삭제되었는지 확인

---

### Phase 2: 실시간 동기화 테스트

#### 2.1 다중 탭 동기화
```bash
1. 브라우저에서 새 탭 열기 (Ctrl + T)
2. 같은 URL 접속: http://localhost:3000
3. 두 탭 모두 로그인 상태 확인
4. 첫 번째 탭에서 거래 추가
5. 두 번째 탭 확인
```

**예상 결과**:
- ✅ 두 번째 탭에서 자동으로 새 거래가 표시됨 (새로고침 불필요)
- ✅ 브라우저 콘솔에 "Real-time update: ..." 로그 표시

---

#### 2.2 Supabase Dashboard에서 직접 수정
```bash
1. Supabase Dashboard > Table Editor > transactions 열기
2. 기존 거래 하나 선택
3. Edit Row 클릭
4. amount를 100000으로 변경
5. Save 클릭
6. 브라우저 탭으로 돌아가기
```

**예상 결과**:
- ✅ 브라우저에서 금액이 자동으로 업데이트됨
- ✅ 대시보드의 총계도 자동으로 재계산됨

---

#### 2.3 Supabase Dashboard에서 직접 삭제
```bash
1. Supabase Dashboard > Table Editor > transactions
2. 거래 하나 선택
3. Delete Row 클릭
4. 브라우저 탭 확인
```

**예상 결과**:
- ✅ 브라우저에서 해당 거래가 자동으로 사라짐
- ✅ 실시간 구독이 DELETE 이벤트를 감지함

---

### Phase 3: 사용자별 데이터 분리 테스트 (RLS)

#### 3.1 다른 계정으로 로그인
```bash
1. 현재 로그아웃
2. 새로운 이메일로 회원가입
3. 로그인
4. 거래 내역 확인
```

**예상 결과**:
- ✅ 비어있는 거래 내역 목록 표시
- ✅ 이전 사용자의 거래는 보이지 않음
- ✅ 새 거래 추가 시 현재 사용자 ID로 저장됨

**Supabase Dashboard 확인**:
1. transactions 테이블 열기
2. 각 거래의 `user_id` 컬럼 확인
3. 두 사용자의 데이터가 분리되어 있는지 확인

---

### Phase 4: 에러 처리 테스트

#### 4.1 네트워크 오프라인 시뮬레이션
```bash
1. 브라우저 개발자 도구 열기 (F12)
2. Network 탭 선택
3. "Offline" 체크박스 선택
4. 거래 추가 시도
```

**예상 결과**:
- ✅ 에러 알림 메시지 표시: "거래 내역 추가에 실패했습니다."
- ✅ 브라우저 콘솔에 에러 로그
- ✅ 앱이 크래시되지 않음

---

#### 4.2 잘못된 데이터 입력
```bash
1. 거래 추가 폼 열기
2. 금액에 음수 입력: -1000
3. 추가 버튼 클릭 시도
```

**예상 결과**:
- ✅ HTML5 폼 검증으로 음수 입력 방지
- ✅ 또는 서버에서 CHECK 제약 조건으로 거부

---

### Phase 5: 통화 변환 테스트

#### 5.1 다중 통화 거래 추가
```bash
1. 거래 추가 - 통화: KRW, 금액: 10000
2. 거래 추가 - 통화: USD, 금액: 10
3. 거래 추가 - 통화: JPY, 금액: 1000
4. 대시보드에서 통화 선택기로 USD 선택
```

**예상 결과**:
- ✅ 모든 거래가 USD로 환산되어 표시됨
- ✅ 총 수입/지출/잔액이 USD로 계산됨
- ✅ 환율 정보 표시 확인

**Supabase Dashboard 확인**:
- 각 거래의 `amount_in_krw` 컬럼에 원화 환산 금액이 정확히 저장되었는지 확인

---

### Phase 6: 캘린더 뷰 테스트

#### 6.1 캘린더에서 거래 확인
```bash
1. 대시보드 상단에서 "캘린더" 탭 클릭
2. 거래가 있는 날짜 확인
3. 해당 날짜 클릭
```

**예상 결과**:
- ✅ 날짜별로 거래 내역이 표시됨
- ✅ 수입/지출 금액이 날짜 셀에 표시됨
- ✅ 날짜 클릭 시 상세 모달 표시

---

#### 6.2 캘린더에서 직접 거래 추가
```bash
1. 캘린더 뷰에서 특정 날짜 클릭
2. "이 날짜에 거래 추가" 버튼 클릭
3. 거래 정보 입력
4. 추가 버튼 클릭
```

**예상 결과**:
- ✅ 선택한 날짜로 거래가 추가됨
- ✅ 캘린더에 즉시 반영됨
- ✅ 날짜 모달을 닫고 다시 열면 새 거래가 표시됨

---

### Phase 7: 통계 뷰 테스트

#### 7.1 통계 차트 확인
```bash
1. 대시보드 상단에서 "통계 분석" 탭 클릭
2. 기간 선택: "1개월"
3. 차트 확인:
   - 월별 트렌드 (Line Chart)
   - 카테고리별 지출 (Pie Chart)
   - 요일별 평균 (Bar Chart)
```

**예상 결과**:
- ✅ 모든 차트가 정상적으로 렌더링됨
- ✅ 데이터가 정확하게 표시됨
- ✅ 통화 변환 시 차트도 자동 업데이트됨

---

## 🐛 알려진 이슈 및 해결 방법

### Issue 1: 실시간 구독이 작동하지 않음
**증상**: 다른 탭이나 Supabase Dashboard에서 변경해도 자동 업데이트 안 됨

**해결 방법**:
1. Supabase Dashboard > Settings > API > Realtime 확인
2. "Enable Realtime" 설정이 켜져 있는지 확인
3. transactions 테이블의 Realtime이 활성화되어 있는지 확인

---

### Issue 2: 거래 추가 시 "Failed to add transaction" 에러
**증상**: 거래 추가 시 알림 창에 에러 메시지

**해결 방법**:
1. 브라우저 콘솔(F12)에서 상세 에러 확인
2. RLS 정책이 올바르게 설정되었는지 확인
3. 사용자가 로그인되어 있는지 확인 (`user` 객체가 null이 아닌지)

---

### Issue 3: 페이지 로드 시 거래 내역이 표시되지 않음
**증상**: 로그인 후 빈 화면만 표시됨

**해결 방법**:
1. 브라우저 콘솔에서 에러 확인
2. `.env.local` 파일의 Supabase URL과 ANON_KEY 확인
3. Supabase 프로젝트가 정상 작동 중인지 확인
4. 네트워크 탭에서 API 요청 상태 확인

---

## 📊 성능 체크리스트

### 로딩 시간
- [ ] 거래 내역 로드: 1초 이내
- [ ] 거래 추가 응답: 500ms 이내
- [ ] 거래 삭제 응답: 500ms 이내
- [ ] 실시간 동기화 지연: 1초 이내

### 데이터 정확성
- [ ] 환율 계산이 정확함
- [ ] 날짜 표시가 정확함 (KST 기준)
- [ ] 총계 계산이 정확함
- [ ] 사용자별 데이터가 분리됨

### 사용자 경험
- [ ] 로딩 상태 표시가 명확함
- [ ] 에러 메시지가 이해하기 쉬움
- [ ] 버튼 동작이 직관적임
- [ ] 반응형 디자인이 올바르게 작동함

---

## 🎯 다음 단계

테스트를 완료한 후:

1. **발견된 버그 보고** - 이슈 트래커에 기록
2. **성능 최적화** - 느린 쿼리 개선
3. **추가 기능 개발** - 일본 초기비용 데이터 Supabase 연동
4. **문서화 완료** - 사용자 가이드 작성

---

## 📝 테스트 결과 기록

### 테스트 일자: ____________

| 테스트 항목 | 결과 (✅/❌) | 비고 |
|-----------|------------|------|
| 거래 추가 | | |
| 거래 조회 | | |
| 거래 삭제 | | |
| 실시간 동기화 | | |
| 사용자별 데이터 분리 | | |
| 에러 처리 | | |
| 통화 변환 | | |
| 캘린더 연동 | | |
| 통계 차트 | | |

**테스터**: ____________
**전체 평가**: ____________

---

*이 문서는 Supabase 거래 내역 연동 기능의 테스트 가이드입니다. 모든 테스트를 완료한 후 프로덕션 배포를 진행하시기 바랍니다.*
